/*
 ??????
 */
#include "fusion.h"

_st_AngE eulerAngle = {0.0f, 0.0f, 0.0f};
_st_Mpu pMpu = {0};

float Now_yaw;
float angular_rate_current = 0.0f; // ????????????????0
void imuComputer(void)
{

  IMU660RAReadAcc((short *)&pMpu);
  IMU660RAReadGyro((short *)&pMpu + 3);
  // ??????????
  angular_rate_current = pMpu.gyroZ * Gyro_Gr * 10; // ???????Z?????????????Gyro_Gr?????¦Ë???
  /* ????§µ? */
  imu_data_calibration(&pMpu.gyroX, &pMpu.gyroY, &pMpu.gyroZ, &pMpu.accX, &pMpu.accY, &pMpu.accZ);

  kalman_filter_new(&pMpu);

  imuUpdate(&pMpu, &eulerAngle, 0.003f);
}
float cha_yaw;
void huandao_yaw()
{
  // ?????yaw???
  cha_yaw = eulerAngle.yaw;

  if (Circle.now_yaw < 0)
  {
      Circle.now_yaw += 360.0f; // ??????????
  }
  else if (Circle.now_yaw >= 360.0f)
  {
      Circle.now_yaw -= 360.0f; // ????????0??360?????
  }
}
